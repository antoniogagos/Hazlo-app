<link rel="import" href="../bower_components/polymer/polymer-element.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="icons.html">


<dom-module id="hazlo-addtask-page">
  <template>
    <style include="toolbar-styles btn-styles">

      :host {
        display: block;
        height: 100%;
        max-width: 750px;
        margin: auto;
      }

      .content {
        padding: 20px;
      }

      .task-input {
        background-color: inherit;
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 5px;
        width: 100%;

        border: none;
        border-bottom: 2px solid #c7c7c7;
      }

      .task-input:focus {
        outline: none;
      }

      .project {
        display: none;
        background-color: #eee;
        padding: 5px;
      }

      .dropdown {
        display: block;
       }

       .dates {
         display: flex;
         justify-content: space-between;
         padding: 10px;
         text-align: center;
       }

       .dates > div {
         margin: 10px;
         flex-wrap: wrap;
         color: #929292;
         padding: 10px;
       }

       .dates .active {
         color: black;
         box-shadow: 0px 0px 7px 1px #009eeb;
       }

    </style>

    <div class="toolbar">
      <iron-icon on-click="_back" icon="arrow-back"></iron-icon>
      <div class="toolbar__title">Add Task</div>
    </div>

    <div class="content">

      <!-- task name input -->
      <div>
        <span style="font-size: 13px; color: #9a9a9a;">Task Name</span>
        <input class="task-input" type="text">
      </div>

      <!-- select task category -->
      <div style="margin-top: 30px;">
        <span style="font-size: 13px; color: #9a9a9a;">Project</span>

        <div on-click="_dropdown" style="width: 100%; margin-bottom: 5px; display: flex; border-bottom: 2px solid #c7c7c7;">
          <div id="colorProject" style="width: 10px; height: 10px; margin-top: 6px; margin-right: 10px;"></div>
          <span style="margin-right: auto;">{{taskProject}}</span>
          <iron-icon icon="arrow-down" style="width: 14px;"></iron-icon>
        </div>

        <dom-repeat id="taskProject">
          <template>

            <div class="project">
              <div on-click="_toggleSelection">{{item.name}}</div>
            </div>

          </template>
        </dom-repeat>
      </div>

      <!-- task date-->
      <div style="margin-top: 30px;">
        <span>Date</span>
        <div class="dates">

          <div class="active">
            <iron-icon style="width: 50px; height: 50px;" icon="today"></iron-icon>
            <div class="date-text">Today</div>
          </div>

          <div>
            <iron-icon style="width: 50px; height: 50px;" icon="tomorrow"></iron-icon>
            <div class="date-text">Tomorrow</div>
          </div>

          <div>
            <iron-icon style="width: 50px; height: 50px; fill: #eee" icon="week"></iron-icon>
            <div class="date-text">Next Week</div>
          </div>

        </div>
      </div>

      <button on-click="_saveBtn" class="btn" style="margin-top: 100px;">Save</button>


    </div>
  </template>
  <script>

    class HazloAddtaskPage extends Polymer.ElementÂ {

      static get is() {return 'hazlo-addtask-page';}

      static get properties() {
        return {
          projects: {
            type: Array,
            value() {
              return [
                {name: 'Business', color: '#4CAF50'},
                {name: 'Friends', color: '#29B6F6'},
                {name: 'Personal', color: '#FF9800'},
              ]
            }
          },

          taskProject: {
            type: String,
            value: '',
          },

          task: {
            type: Array,
            value() {
              return [];
            }
          },

        }
      }

      connectedCallback() {
        super.connectedCallback();

        this.taskProject = this.projects[0].name;
        this.$.colorProject.style.backgroundColor = this.projects[0].color;

        var taskProject = this.$.taskProject;
        taskProject.items = this.projects;

        var taskDates = this.shadowRoot.querySelectorAll('.dates > div');

        taskDates.forEach(date => {
          date.addEventListener('click', e => {
            for (var index = 0; index < taskDates.length; index++) {
              var element = taskDates[index];
              if ( element.classList.contains('active')) {
                element.classList.remove('active');
              }
            }
            date.classList.add('active')
          });
        });
      }

      _saveBtn() {
        var taskInput = this.shadowRoot.querySelector('.task-input');
        var taskDate = this.shadowRoot.querySelector('.active .date-text');

        if (!taskInput.value == '') {
          this.push('task', {taskText: taskInput.value, project: this.taskProject, date: taskDate.textContent});

          var newTask = this.task.slice(-1)[0];

          this.dispatchEvent(new CustomEvent('add-task', {
            bubbles: true,
            composed: true,
            detail: {
              task: newTask
            }
          }));

        } else {
          console.log('There is no task name');
        }
      }

      _dropdown() {
        var project = this.shadowRoot.querySelectorAll('.project');

        project.forEach(p => {
          p.classList.toggle('dropdown');
        });
      }

      _toggleSelection(e) {
        var item = this.$.taskProject.itemForElement(e.target);
        this.set('taskProject', item.name);

        this.$.colorProject.style.backgroundColor = item.color;
      }

      _back() {
        this.dispatchEvent(new CustomEvent('go-back', {
          bubbles: true,
          composed: true
        }));
      }

    }

    customElements.define(HazloAddtaskPage.is, HazloAddtaskPage);
  </script>
</dom-module>