<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="icons.html">

<dom-module id="hazlo-dashboard-page">
  <template>
    <style include="toolbar-styles btn-styles">

      :host {
        display: block;
        height: 100%;
      }

      iron-icon[icon="bell-outline"] {
        margin-left: auto;
      }

      .subheader {
        align-items: center;
        border-bottom: 2px solid #eee;
        display: flex;
        padding: 10px 20px;
      }

      #weather-icon {
        display: flex;
        height: 200px;
        margin: 0 auto;
        width: 200px;
      }

      .empty-dashboard {
        margin-top: 125px;
      }

      .task {
        border-bottom: 2px solid #eee;
        padding: 30px;
      }

      .task__name {
        font-size: 28px;
        letter-spacing: 1px;
        margin-bottom: 10px;
      }

      .task__date {
        font-size: 14px;
        color: #cecece;
      }

      .task__project {
        color: #cecece;
      }

      .task .btn {
        margin: 0;
        margin-top: 20px;
      }

      .task-counter {
        background-color: #6fcc09;
        border-radius: 100%;
        box-shadow: 0px 0px 3px 0px #6fcc09;
        color: white;
        padding: 4px 10px;
      }

      .undone {
        background-color: #e64040;
        box-shadow: 0px 0px 6px 0px #c72525;
      }

    </style>

    <div class="toolbar">
      <iron-icon icon="menu" on-click="_menuTapped"></iron-icon>
      <div class="toolbar__title">Hazlo</div>
      <iron-icon icon="bell-outline"></iron-icon>
      <iron-icon on-click="openAnimatedOverlay" icon="plus-circle-outline"></iron-icon>
    </div>

    <div class="content">

      <div class="subheader">
        <p style="color: #757575; margin-left: 10px; margin-right: auto;">Today</p>
        <div class="task-counter">[[taskCounter]]</div>
      </div>

      <div id="tasks">
        <dom-repeat items="{{notes}}">
          <template>
            <div class="task">
              <div class="task__date">[[item.date]]</div>
              <div class="task__name">[[item.content]]</div>
              <div class="task__project">[[item.project]]</div>

              <button note="[[item]]" on-click="_deleteTask" class="btn">delete</button>
              <button note="[[item]]" on-click="_editTask" class="btn">edit</button>
            </div>

          </template>
        </dom-repeat>
      </div>

    </div>

    <div class="empty-dashboard">
      <iron-icon id="weather-icon" icon="weather"></iron-icon>
      <p style="text-align:center; color: #757575;">No Task for Today. Enjoy!</p>

      <button class="btn" on-click="openAnimatedOverlay" style="margin-top: 50px;">add task</button>
    </div>

    <overlay-container></overlay-container>

  </template>
  <script>

  class HazloDashboardPage extends Polymer.Element {

    static get is() {return 'hazlo-dashboard-page';}

    static get properties() {
      return {
        taskCounter: {
          type: Number,
          value: 0
        },

        tasks: {
          type: Array,
          value: _ => {
            return [];
          }
        },

        notes: Object,

      };
    }

    static get observers() {
      return [
        '_tasks(notes.length)',
      ]
    }

    connectedCallback() {
      super.connectedCallback();

      document.body.addEventListener('projects-overlay', _ => {
        window.overlay = document.createElement('projects-overlay');
        overlay.open();
      });

      document.body.addEventListener('open-project-builder', _ =>Â {
        window.overlay = document.createElement('project-builder-overlay');
        overlay.open();
      });

    }

    _deleteTask(e) {
      var key = e.currentTarget.note.$key;

      this.dispatchEvent(new CustomEvent('delete-task', {
        bubbles: true,
        composed: true,
        detail: {
          "key": key
        }
      }));
    }

    _editTask(e) {
      window.overlay = document.createElement('hazlo-edit-task');
      overlay.item = e.currentTarget.note;
      overlay.open();

    }

    _tasks(counter) {
      var empty_dashboard = this.shadowRoot.querySelector('.empty-dashboard');
      var taskCounter = this.shadowRoot.querySelector('.task-counter');

      if ( counter == 0 ) {
        empty_dashboard.style.display = 'block';
        taskCounter.classList.remove('undone');
      } else {
        empty_dashboard.style.display = 'none';
        taskCounter.classList.add('undone');
      }

      this.taskCounter = counter;
    }

    _menuTapped() {
      this.dispatchEvent(new CustomEvent('open-drawer', {
        bubbles: true,
        composed: true
      }));
    }

    openAnimatedOverlay() {
      window.overlay = document.createElement('addtask-overlay');
      overlay.open();
    }

  }

  customElements.define(HazloDashboardPage.is, HazloDashboardPage);

  </script>
</dom-module>